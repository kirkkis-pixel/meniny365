---
// No server-side logic needed for this component
---

<div class="gift-ideas-form bg-white rounded-2xl p-8 shadow-lg border border-slate-200/50">
  <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">Generátor darčekových nápadov</h3>
  
  <form id="giftForm" class="space-y-6">
    <!-- Name Input -->
    <div>
      <label for="giftName" class="block text-sm font-medium text-slate-700 mb-2">
        Pre koho je darček?
      </label>
      <input 
        type="text" 
        id="giftName" 
        name="name"
        required
        class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
        placeholder="Zadajte meno..."
        aria-label="Meno osoby pre ktorú je darček"
      >
    </div>
    
    <!-- Budget Range -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-2">
        Rozpočet
      </label>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label for="budgetMin" class="block text-xs text-slate-600 mb-1">Od (€)</label>
          <input 
            type="number" 
            id="budgetMin" 
            name="budgetMin"
            min="5"
            max="500"
            value="25"
            class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            aria-label="Minimálny rozpočet v eurách"
          >
        </div>
        <div>
          <label for="budgetMax" class="block text-xs text-slate-600 mb-1">Do (€)</label>
          <input 
            type="number" 
            id="budgetMax" 
            name="budgetMax"
            min="5"
            max="500"
            value="75"
            class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            aria-label="Maximálny rozpočet v eurách"
          >
        </div>
      </div>
    </div>
    
    <!-- Relation -->
    <div>
      <label for="relation" class="block text-sm font-medium text-slate-700 mb-2">
        Vzťah
      </label>
      <select 
        id="relation" 
        name="relation"
        class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
        aria-label="Vzťah k osobe"
      >
        <option value="rodina">Rodina</option>
        <option value="priatel">Priateľ/Priateľka</option>
        <option value="partner">Partner/Partnerka</option>
        <option value="kolega">Kolega/Kolegyňa</option>
        <option value="ucitel">Učiteľ/Učiteľka</option>
        <option value="sused">Sused/Susedka</option>
      </select>
    </div>
    
    <!-- Style -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-2">
        Štýl darčeka
      </label>
      <div class="grid grid-cols-2 gap-2">
        <label class="flex items-center space-x-2 cursor-pointer">
          <input type="checkbox" name="styles" value="klasicky" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
          <span class="text-sm text-slate-700">Klasický</span>
        </label>
        <label class="flex items-center space-x-2 cursor-pointer">
          <input type="checkbox" name="styles" value="moderny" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
          <span class="text-sm text-slate-700">Moderný</span>
        </label>
        <label class="flex items-center space-x-2 cursor-pointer">
          <input type="checkbox" name="styles" value="romanticky" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
          <span class="text-sm text-slate-700">Romantický</span>
        </label>
        <label class="flex items-center space-x-2 cursor-pointer">
          <input type="checkbox" name="styles" value="prakticky" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
          <span class="text-sm text-slate-700">Praktický</span>
        </label>
        <label class="flex items-center space-x-2 cursor-pointer">
          <input type="checkbox" name="styles" value="zabavny" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
          <span class="text-sm text-slate-700">Zábavný</span>
        </label>
        <label class="flex items-center space-x-2 cursor-pointer">
          <input type="checkbox" name="styles" value="luxusny" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
          <span class="text-sm text-slate-700">Luxusný</span>
        </label>
      </div>
    </div>
    
    <!-- Delivery Speed -->
    <div>
      <label for="delivery" class="block text-sm font-medium text-slate-700 mb-2">
        Rýchlosť doručenia
      </label>
      <select 
        id="delivery" 
        name="delivery"
        class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
        aria-label="Rýchlosť doručenia"
      >
        <option value="tyzden">Týždeň (štandardné)</option>
        <option value="2dni">2 dni (rýchle)</option>
        <option value="dnes">Dnes (expresné)</option>
      </select>
    </div>
    
    <!-- Submit Button -->
    <button 
      type="submit" 
      class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 px-6 rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 shadow-lg"
      aria-label="Generovať darčekové nápady"
    >
      <span class="flex items-center justify-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
        <span>Generovať nápady</span>
      </span>
    </button>
  </form>
  
  <!-- Loading State -->
  <div id="loadingState" class="hidden text-center py-8">
    <div class="inline-flex items-center space-x-3">
      <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div>
      <span class="text-slate-600">Generujem nápady...</span>
    </div>
  </div>
</div>

<script>
  document.getElementById('giftForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const form = e.target as HTMLFormElement;
    const formData = new FormData(form);
    
    // Collect form data
    const filters = {
      name: formData.get('name') as string,
      budgetMin: parseInt(formData.get('budgetMin') as string) || 25,
      budgetMax: parseInt(formData.get('budgetMax') as string) || 75,
      relation: formData.get('relation') as string || 'rodina',
      styles: formData.getAll('styles') as string[],
      delivery: formData.get('delivery') as string || 'tyzden'
    };
    
    // Show loading state
    const formElement = document.getElementById('giftForm');
    const loadingElement = document.getElementById('loadingState');
    
    if (formElement && loadingElement) {
      formElement.classList.add('hidden');
      loadingElement.classList.remove('hidden');
    }
    
    try {
      // Call API
      const response = await fetch('/api/ai/gifts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ filters })
      });
      
      if (!response.ok) {
        throw new Error('Failed to generate gift ideas');
      }
      
      const data = await response.json();
      
      // Emit custom event with results
      const event = new CustomEvent('giftIdeasGenerated', {
        detail: data
      });
      document.dispatchEvent(event);
      
    } catch (error) {
      console.error('Error generating gift ideas:', error);
      
      // Show error message
      const errorDiv = document.createElement('div');
      errorDiv.className = 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-center';
      errorDiv.textContent = 'Chyba pri generovaní nápadov. Skúste to znova.';
      
      if (loadingElement) {
        loadingElement.innerHTML = '';
        loadingElement.appendChild(errorDiv);
      }
    }
  });
</script>
