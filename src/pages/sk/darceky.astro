---
import Layout from '../../layouts/Layout.astro';
import Card from '../../components/Card.astro';
import SectionHeader from '../../components/SectionHeader.astro';
import GiftForm from '../../components/GiftForm.astro';
import GiftList from '../../components/GiftList.astro';

// Get prefilled name from URL params
const url = new URL(Astro.request.url);
const prefilledName = url.searchParams.get('name') || '';
---

<Layout 
           title="Darčeky k meninám | meniny365.sk"
           description="Nájdi inšpiráciu na darček podľa mena, rozpočtu a štýlu. Detailné nápady a popisy pre dokonalý výber."
         >
  <div class="min-h-screen">
  <!-- Cache bust v14 - FORCE DEPLOYMENT - Content width fixed -->  <!-- Hero Section -->
    <div class="bg-white border-b border-slate-200">
      <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="text-center">
          <!-- AI-powered pill -->
          <div class="inline-flex items-center bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium mb-6">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
            </svg>
            AI-powered
          </div>
          
          <h1 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">
            Darčeky k meninám
          </h1>
                   <p class="text-lg text-slate-600 max-w-2xl mx-auto">
                     Nájdi inšpiráciu na darček podľa mena, rozpočtu a štýlu. Detailné nápady a popisy pre dokonalý výber.
          </p>
        </div>
          </div>
        </div>
        
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Gift Form -->
        <Card class="p-6">
          <SectionHeader
            eyebrow="Inšpirácie"
            title="Darčeky podľa mena"
            subtitle="Nájdi rýchlo tip na darček k meninám"
          />
          <GiftForm prefilledName={prefilledName} />
        </Card>

        <!-- Gift Results -->
        <Card class="p-6">
          <h3 class="text-xl font-bold text-slate-900 mb-6">Navrhnuté darčeky</h3>
          <div id="giftResults">
            <GiftList gifts={[]} />
          </div>
        </Card>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('giftForm');
      const giftResults = document.getElementById('giftResults');
      const submitButton = form.querySelector('button[type="submit"]');

      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Show loading state
        submitButton.disabled = true;
        submitButton.textContent = 'Načítavam...';
        
        try {
          // Get form data
          const formData = new FormData(form);
          const filters = {
            budget: formData.get('budget'),
            relationship: formData.get('relationship'),
            type: formData.getAll('type'),
            style: formData.getAll('style'),
            delivery: formData.get('delivery'),
            name: formData.get('name')
          };

          // Call API
          const response = await fetch('/api/gifts', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(filters)
          });
          
          const result = await response.json();
          
          if (result.success) {
            // Update the gift results
            giftResults.innerHTML = `
              <div class="space-y-6">
                ${result.gifts.map(gift => `
                  <div class="gift-card bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl shadow-sm border border-slate-200 hover:shadow-lg hover:border-slate-300 transition-all duration-300 overflow-hidden">
                    <div class="flex flex-col lg:flex-row">
                      <!-- Header Section -->
                      <div class="lg:w-80 h-32 lg:h-auto bg-gradient-to-r from-slate-200 to-slate-300 flex items-center justify-between px-6 py-4">
                        <!-- Category Badge -->
                        <div class="bg-white px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 shadow-sm">
                          ${gift.category}
                        </div>
                        
                        <!-- Price Badge -->
                        ${gift.price ? `
                          <div class="bg-slate-900 text-white px-3 py-2 rounded-lg text-sm font-bold shadow-lg">
                            ${gift.price}
                          </div>
                        ` : ''}
                      </div>
                      
                      <!-- Content Section -->
                      <div class="flex-1 p-6">
                        <!-- Title -->
                        <h3 class="text-xl font-semibold text-slate-900 mb-3 leading-tight">
                          ${gift.title}
                        </h3>
                        
                        <!-- Description -->
                        <p class="text-slate-600 text-sm mb-4 leading-relaxed">
                          ${gift.why}
                        </p>
                        
                        <!-- Tags -->
                        <div class="flex flex-wrap gap-1.5 mb-6">
                          ${gift.tags.slice(0, 5).map(tag => `
                            <span class="px-2 py-1 rounded text-xs font-medium ${getTagColor(tag)}">
                              ${tag}
                            </span>
                          `).join('')}
                        </div>
                        
                        <!-- CTA Button -->
                        <a
                          href="${gift.affiliateUrl}"
                          target="_blank"
                          rel="noopener noreferrer"
                          class="inline-flex items-center justify-center bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-lg text-base font-semibold hover:from-blue-700 hover:to-blue-800 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
                        >
                          Nájsť podobné
                          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
        </svg>
      </a>
    </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `;
          } else {
            giftResults.innerHTML = `
              <div class="text-center py-8">
                <div class="text-red-500 mb-2">Chyba pri načítaní darčekov</div>
                <p class="text-slate-600">Skúste to prosím znova.</p>
              </div>
            `;
          }
        } catch (error) {
          console.error('Error:', error);
          giftResults.innerHTML = `
            <div class="text-center py-8">
              <div class="text-red-500 mb-2">Chyba pri načítaní darčekov</div>
              <p class="text-slate-600">Skúste to prosím znova.</p>
            </div>
          `;
        } finally {
          // Reset button state
          submitButton.disabled = false;
          submitButton.textContent = 'Ukáž darčeky';
        }
      });


      function getTagColor(tag) {
        const colors = {
          'eco': 'bg-green-100 text-green-800',
          'minimalistický': 'bg-gray-100 text-gray-800',
          'luxusný': 'bg-yellow-100 text-yellow-800',
          'hravý': 'bg-pink-100 text-pink-800',
          'romantický': 'bg-red-100 text-red-800',
          'fyzický darček': 'bg-blue-100 text-blue-800',
          'digitálne': 'bg-indigo-100 text-indigo-800',
          'zážitok': 'bg-orange-100 text-orange-800',
          'rozpočtový': 'bg-green-100 text-green-800',
          'stredný': 'bg-blue-100 text-blue-800',
          'kvalitný': 'bg-purple-100 text-purple-800',
          'praktický': 'bg-cyan-100 text-cyan-800',
          'elegantný': 'bg-gray-100 text-gray-800',
          'modernejší': 'bg-teal-100 text-teal-800',
          'tradičný': 'bg-amber-100 text-amber-800',
          'osobný': 'bg-violet-100 text-violet-800',
          'dekoratívny': 'bg-fuchsia-100 text-fuchsia-800',
          'relax': 'bg-lime-100 text-lime-800',
          'zdravý': 'bg-green-100 text-green-800',
          'interaktívny': 'bg-yellow-100 text-yellow-800',
          'outdoor': 'bg-green-100 text-green-800',
          'technický': 'bg-slate-100 text-slate-800',
          'profesionálny': 'bg-indigo-100 text-indigo-800',
          'hobby': 'bg-orange-100 text-orange-800',
          'šport': 'bg-red-100 text-red-800',
          'gaming': 'bg-purple-100 text-purple-800',
          'práca': 'bg-slate-100 text-slate-800',
          'romantika': 'bg-red-100 text-red-800',
          'spomienky': 'bg-pink-100 text-pink-800',
          'šperky': 'bg-amber-100 text-amber-800',
          'kuchyňa': 'bg-orange-100 text-orange-800',
          'domov': 'bg-green-100 text-green-800',
          'zábava': 'bg-blue-100 text-blue-800',
          'praktické': 'bg-cyan-100 text-cyan-800',
          'technológie': 'bg-indigo-100 text-indigo-800',
          'všeobecné': 'bg-gray-100 text-gray-800'
        };
        return colors[tag] || 'bg-slate-100 text-slate-800';
      }
    });
  </script>


</Layout>
