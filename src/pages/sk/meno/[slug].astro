---
import Layout from '../../../layouts/Layout.astro';
import { getDatesByName, getAllNames, getNextOccurrence, getPrevOccurrence } from '../../../lib/meniny';
import { toSlug, fromSlug } from '../../../lib/slug';
import { formatDateSlovak } from '../../../lib/date';

export async function getStaticPaths() {
  // Get all names and generate paths
  const allNames = await getAllNames();
  
  return allNames.map(name => ({
    params: {
      slug: toSlug(name)
    }
  }));
}

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/sk');
}

// Find the actual name from the slug
const allNames = await getAllNames();
const actualName = allNames.find(name => toSlug(name) === slug);

if (!actualName) {
  return Astro.redirect('/sk');
}

const dates = await getDatesByName(actualName);
const nextOccurrence = await getNextOccurrence(actualName, new Date());
const prevOccurrence = await getPrevOccurrence(actualName, new Date());

// Generate structured data
const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": `${actualName} - meniny, pÃ´vod, darÄeky`,
  "description": `Meno ${actualName} mÃ¡ meniny ${dates.length} krÃ¡t do roka. Zistite kedy, nÃ¡jdite darÄekovÃ© nÃ¡pady a viac informÃ¡ciÃ­.`,
  "url": `https://meniny365.sk/sk/meno/${slug}`,
  "mainEntity": {
    "@type": "Person",
    "name": actualName,
    "description": `Meno ${actualName} mÃ¡ meniny ${dates.length} krÃ¡t do roka`,
    "birthDate": dates[0] || null
  }
};
---

<Layout 
  title={`${actualName} - meniny, pÃ´vod, darÄeky | meniny365`}
  description={`Meno ${actualName} mÃ¡ meniny ${dates.length} krÃ¡t do roka. Zistite kedy, nÃ¡jdite darÄekovÃ© nÃ¡pady a viac informÃ¡ciÃ­ o pÃ´vode mena.`}
  canonical={`https://meniny365.sk/sk/meno/${slug}`}
  structuredData={structuredData}
>
  <div class="container py-8">
    <!-- Breadcrumbs -->
    <nav class="mb-8">
      <ol class="flex items-center space-x-2 text-sm text-[var(--muted)]">
        <li><a href="/sk" class="hover:text-[var(--brand)] transition-colors">Dnes</a></li>
        <li>/</li>
        <li class="text-[var(--text)]">{actualName}</li>
      </ol>
    </nav>

    <!-- Name Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-[var(--text)] mb-4">
        {actualName}
      </h1>
      
      <div class="flex justify-center items-center space-x-4 mb-8">
        <span class="px-4 py-2 bg-[var(--brand)]/20 text-[var(--brand)] rounded-full text-sm font-medium">
          Meniny
        </span>
        <span class="px-4 py-2 bg-[var(--accent)]/20 text-[var(--accent)] rounded-full text-sm font-medium">
          {dates.length} krÃ¡t do roka
        </span>
      </div>
      
      <div class="card p-6 max-w-2xl mx-auto">
        <a 
          href={`/api/ical?name=${encodeURIComponent(actualName)}`}
          class="btn btn-primary text-lg px-6 py-3"
          download={`${actualName}-meniny.ics`}
        >
          ğŸ“… PridaÅ¥ do kalendÃ¡ra
        </a>
      </div>
    </div>

    <!-- DÃ¡tumy menÃ­n -->
    <div class="card p-8 mb-12">
      <h2 class="text-2xl font-semibold text-[var(--text)] mb-6">DÃ¡tumy menÃ­n</h2>
      
      {dates.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {dates.map(dateStr => {
            const date = new Date(dateStr);
            const isUpcoming = date >= new Date();
            
            return (
              <a
                href={`/sk/den/${dateStr.split('-')[0]}/${dateStr.split('-')[1]}/${dateStr.split('-')[2]}`}
                class={`
                  p-4 rounded-lg border transition-all
                  ${isUpcoming 
                    ? 'bg-[var(--brand)]/10 border-[var(--brand)] hover:bg-[var(--brand)]/20' 
                    : 'bg-[var(--card)] border-[var(--border)] hover:bg-[var(--hover)]'
                  }
                `}
              >
                <div class="text-lg font-semibold text-[var(--text)]">
                  {formatDateSlovak(date)}
                </div>
                {isUpcoming && (
                  <div class="text-sm text-[var(--brand)] mt-1">
                    NajbliÅ¾Å¡Ã­ termÃ­n
                  </div>
                )}
              </a>
            );
          })}
        </div>
      ) : (
        <p class="text-[var(--muted)]">Å½iadne dÃ¡tumy menÃ­n nie sÃº dostupnÃ©.</p>
      )}
    </div>

    <!-- DarÄekovÃ© nÃ¡pady -->
    <div class="card p-8 mb-12">
      <h2 class="text-2xl font-semibold text-[var(--text)] mb-6">DarÄekovÃ© nÃ¡pady pre {actualName}</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="p-4 border border-[var(--border)] rounded-lg">
          <h3 class="font-semibold text-[var(--text)] mb-2">TradiÄnÃ© darÄeky</h3>
          <ul class="text-sm text-[var(--muted)] space-y-1">
            <li>â€¢ Kvetiny</li>
            <li>â€¢ ÄŒokolÃ¡da</li>
            <li>â€¢ Kniha</li>
            <li>â€¢ ParfÃ©m</li>
          </ul>
        </div>
        
        <div class="p-4 border border-[var(--border)] rounded-lg">
          <h3 class="font-semibold text-[var(--text)] mb-2">ModernÃ© darÄeky</h3>
          <ul class="text-sm text-[var(--muted)] space-y-1">
            <li>â€¢ Gadgety</li>
            <li>â€¢ SkÃºsenosti</li>
            <li>â€¢ DigitÃ¡lne darÄeky</li>
            <li>â€¢ PersonalizovanÃ© predmety</li>
          </ul>
        </div>
        
        <div class="p-4 border border-[var(--border)] rounded-lg">
          <h3 class="font-semibold text-[var(--text)] mb-2">PodÄ¾a rozpoÄtu</h3>
          <ul class="text-sm text-[var(--muted)] space-y-1">
            <li>â€¢ Do 20â‚¬ - malÃ© darÄeky</li>
            <li>â€¢ 20-50â‚¬ - strednÃ© darÄeky</li>
            <li>â€¢ 50-100â‚¬ - drahÅ¡ie darÄeky</li>
            <li>â€¢ 100â‚¬+ - luxusnÃ© darÄeky</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- PÃ´vod & vÃ½znam -->
    <div class="card p-8 mb-12">
      <h2 class="text-2xl font-semibold text-[var(--text)] mb-6">PÃ´vod & vÃ½znam</h2>
      
      <div class="prose prose-lg text-[var(--text)]">
        <p class="text-[var(--muted)] leading-relaxed">
          Meno {actualName} mÃ¡ bohatÃº histÃ³riu a zaujÃ­mavÃ½ pÃ´vod. Je to {dates.length > 1 ? 'jedno z mien, ktorÃ© sa oslavuje viackrÃ¡t do roka' : 'meno, ktorÃ© sa oslavuje raz do roka'} 
          a patrÃ­ medzi {dates.length > 3 ? 'najÄastejÅ¡ie oslavovanÃ© menÃ¡' : 'menÃ¡ s menej ÄastÃ½mi meninami'} na Slovensku.
        </p>
        
        <h3 class="text-xl font-semibold mt-6 mb-4">ZaujÃ­mavosti o mene {actualName}</h3>
        <ul class="text-[var(--muted)] space-y-2">
          <li>â€¢ Meno sa oslavuje {dates.length} krÃ¡t do roka</li>
          <li>â€¢ PatrÃ­ medzi {dates.length > 3 ? 'populÃ¡rne' : 'menej ÄastÃ©'} menÃ¡ na Slovensku</li>
          <li>â€¢ {nextOccurrence ? `NajbliÅ¾Å¡ie meniny budÃº ${formatDateSlovak(nextOccurrence)}` : 'Meniny uÅ¾ boli tento rok'}</li>
          <li>â€¢ Meno mÃ¡ {actualName.length} pÃ­smen</li>
        </ul>
      </div>
    </div>

    <!-- PodobnÃ© menÃ¡ -->
    <div class="card p-8 mb-12">
      <h2 class="text-2xl font-semibold text-[var(--text)] mb-6">PodobnÃ© menÃ¡</h2>
      
      <div class="flex flex-wrap gap-3">
        {allNames
          .filter(name => 
            name !== actualName && 
            (name.toLowerCase().includes(actualName.toLowerCase().slice(0, 3)) ||
             actualName.toLowerCase().includes(name.toLowerCase().slice(0, 3)))
          )
          .slice(0, 8)
          .map(name => (
            <a
              href={`/sk/meno/${toSlug(name)}`}
              class="px-4 py-2 bg-[var(--card)] border border-[var(--border)] rounded-lg hover:bg-[var(--hover)] transition-colors"
            >
              {name}
            </a>
          ))
        }
      </div>
    </div>

    <!-- SÃºvisiace ÄlÃ¡nky -->
    <div class="card p-8 mb-12">
      <h2 class="text-2xl font-semibold text-[var(--text)] mb-6">SÃºvisiace ÄlÃ¡nky</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <a href="/sk/blog/meniny-na-slovensku" class="p-4 border border-[var(--border)] rounded-lg hover:bg-[var(--hover)] transition-colors">
          <h3 class="font-semibold text-[var(--text)] mb-2">Meniny na Slovensku: tradÃ­cie a zvyky</h3>
          <p class="text-sm text-[var(--muted)]">Zistite viac o tradÃ­ciÃ¡ch a zvykoch spojenÃ½ch s meninami na Slovensku.</p>
        </a>
        
        <a href="/sk/blog/darceky-na-meniny" class="p-4 border border-[var(--border)] rounded-lg hover:bg-[var(--hover)] transition-colors">
          <h3 class="font-semibold text-[var(--text)] mb-2">20 tipov na darÄeky na meniny</h3>
          <p class="text-sm text-[var(--muted)]">NÃ¡jdite perfektnÃ½ darÄek pre kaÅ¾dÃ½ rozpoÄet a prÃ­leÅ¾itosÅ¥.</p>
        </a>
      </div>
    </div>

    <!-- Related Links -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <a href="/sk" class="card p-6 hover:scale-105 transition-transform">
        <h3 class="text-xl font-semibold text-[var(--text)] mb-2">ğŸ“… Dnes mÃ¡ meniny</h3>
        <p class="text-[var(--muted)]">Zistite kto mÃ¡ dnes meniny</p>
      </a>
      
      <a href="/sk/populÃ¡rne-menÃ¡" class="card p-6 hover:scale-105 transition-transform">
        <h3 class="text-xl font-semibold text-[var(--text)] mb-2">ğŸ”¥ PopulÃ¡rne menÃ¡</h3>
        <p class="text-[var(--muted)]">Zistite ktorÃ© menÃ¡ sÃº najpopulÃ¡rnejÅ¡ie</p>
      </a>
      
      <a href="/sk/nÃ¡vrhy-mena" class="card p-6 hover:scale-105 transition-transform">
        <h3 class="text-xl font-semibold text-[var(--text)] mb-2">ğŸ’¡ NÃ¡vrhy mien</h3>
        <p class="text-[var(--muted)]">NÃ¡jdite perfektnÃ© meno pre vaÅ¡e dieÅ¥a</p>
      </a>
    </div>
  </div>
</Layout>
